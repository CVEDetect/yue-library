# 数据库设计与交付规约v1
## 数据库设计规约
　　请遵守[《阿里巴巴Java开发手册》](https://gitee.com/yl-yue/yue-library/raw/master/docs/_media/Java开发手册（嵩山版）.pdf)数据库设计规约，并确保整体设计风格的一致性。<br>
　　表的设计需符合业务逻辑需求，同时应最大程度上的降低 <font color=red>开发、维护、扩展</font> 成本，并允许拥有一部分合理范围之内的设计模式与理念。<br>
　　服务中台的数据结构应遵循共享原则，不应出现与业务绑定的特殊字段，需做特殊兼容时可考虑扩展设计，如：json、jsonschema、特殊占位字段、业务方自行扩展等方式。

### 命名规约
**设计命名规约**
- 【推荐】增加一个名词约定库，用于统一常用名词在变量命名时的规范使用，避免一个单词被用于多种意思，同一字段使用了不同单词
- 【推荐】同一含义的数据库字段命名与接口参数命名尽量保持一致（包括数据库字段注释与接口参数注释）
  - 【优点】方便追溯与统一理解
  - 【伪缺点】美其名曰为了安全，增加非法访问爆破难度（毫无意义，请将接口加密）

**字段命名后缀规约**
- 【推荐】关联字段命名时，应保留关联标识与语义
  - 【标识】如：`id`、`pid`、`uuid`、`puuid`等
  - 【语义】如：`user`、`person`、`name`等
- 【推荐】枚举类型命名保留枚举语义后缀，没有语义后缀的使用`enum`结尾，同时枚举注释应该将枚举值全部列举
  - 【语义】如：`type`、`status`等
- 【推荐】复数变量使用`s`结尾（如：`ids`），如果变量值是一个待分割的数组，请添加注释说明（如：`,`分割）

**额外补充与重复强调**

|类型		|规约																																					|
|--			|--																																						|
|库命名		|库名与应用（服务）名称尽量一致，同时只允许采用下划线“_”分割，字符集统一使用`utf8mb4`。																|
|表命名		|表的命名最好是加上“业务名称_表的作用”（如：`user_account / user_config / pay_order / pay_log`），数据记录表应只用于新增查询统计，不可执行修改操作。	|
|布尔值命名	|同开发手册，必须使用 `is_xxx` 的方式命名，数据类型是 unsigned tinyint 1位（1 表示是，0 表示否）														|

### 枚举规约
**数据字典表、字符串类型（伪枚举）、数字类型使用场景规约**

|类型					|适用范围																																																						|规约																																											|
|--						|--																																																								|--																																												|
|数据字典表				|行业标准数据，如：行政区划 <br>需动态维护的常量数据，如：类型、分类																																							|固定字典 `dict_final_xx`，不变的或行业标准的数据 <br>常规字典 `dict_xx`，业务自定义的数据																						|
|字符串类型（伪枚举）	|拥有流转状态的业务，如：订单状态 <br>没有流转状态的业务，如：用户状态（正常1、注销2、禁用3）																																	|<font color=red>数据库中禁用enum类型</font>，当字符串（伪枚举）类型需要参与业务逻辑时，<br> **<font color=red>程序中必须定义枚举来解析字符串</font>** ，哪怕只是一个判断或校验	|
|数字类型				|**<font color=red>禁止使用</font>** `1,2,3,4,5...` **<font color=red>之类的数字代替枚举类型</font>** ，数字类型语义化表示不明确，<br>并且在有流转状态的业务中，会出现乱序现象，如：最初定义的1234567由于业务状态变更成了1236745|**<font color=red>禁止使用数字代替枚举</font>**																																|

- 在数据库与 Rpc Protobuf 中，请使用字符串代替 `enum` 类型的使用
- 枚举值即常量值，命名时请遵循大写字母的下划线命名法(`AAA_BBB_CCCC`)，拥有相同规则的常量用前缀表示，不应放在中间或后面
- 在所有文档（接口、程序、数据库）中都应该提供完整清晰的注释（如：`MAN=男、WOMAN=女`）
- 当枚举值需参与业务逻辑时，程序中必须定义枚举类来解析字符串值

## 交付评审规约
- 文档说明，优雅的概括本次变动与自己的设计思路
- 表的位置（链接地址 - 数据库）
- 变更字段的位置
- 完善的表注释与字段注释
- 规范的字段命名，关联字段保持统一风格（不规范的字段命名改动，需提出并获得评审通过）
- 删除表需特别说明 并 <font color=red>加以强调</font>

### 新增表
- 详细概括表的作用与设计思路
- 提供全表DDL
- 表中的约束与索引
- 表与表之间的关系（禁止使用外键）

### 更改表
- 字段变更的说明
- 提供全表DDL
- 本次改动DDL
- 表中的约束与索引

## 维护规约
　　数据库设计并非一蹴而就，开发中发现不合理与遗漏的表设计，需对其进行修改时，必须对其所有变更进行DDL记录与变更说明。<br>
　　项目上线或发布时，数据库同步便可参照本次变更记录做对比，考虑是否有数据结构安全隐患，以作数据的处理。规则如下：
- 每次变动记录详细的变动DLL语句并解释此次变更是为什么
- 变更前先明确表设计初衷，后续为何变更，初衷是否改变，是否需要更新表初衷