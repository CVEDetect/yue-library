# SQL方言
yue-library提供的SQL方言能力，是根据jdbc驱动自动识别的，无需用户配置。如：
- MySQL驱动会识别为MySQL方言
- PostgreSQL驱动会识别为PostgreSQL方言
- Elasticsearch、ClickHouse驱动会识别为ANSI（SQL92、SQL99）方言

SQL方言用于yue-library在自动生成SQL时做兼容判断，如：数据库关键字包装，或者根据数据库特性，生成一些特别的优化SQL。<br>
当你自己写SQL时，你不需要用到任何SQL方言特性，因此yue-library理论上支持所有拥有jdbc驱动的数据库。

## 在动态数据源下面使用SQL方言
动态数据源可以在Spring上下文中动态切换数据源（理论支持动态切换不同数据库），yue-library可以根据驱动自动识别SQL方言，但在多数据源场景，默认只会创建一个Bean（Db），而这个Bean的SQL方言识别来自于主要数据源（配置动态数据源时需要标记一个primary源）。<br>
因此当其他数据源与主要数据源使用不同的SQL方言时，你需要为其他数据源固定指派SQL方言类型，因为yue-library暂不支持动态切换SQL方言（暂未遇到此场景需求，同时动态切换SQL方言可能是个伪需求或业务设计缺陷）。

**在不同数据源下使用匹配的SQL方言：**

[👉更多配置参考：单个DAO、单个Bean、单个Db配置](data/jdbc/Jdbc配置.md#单个dao、单个bean、单个db配置)

```java
@DS("postgresql")
@Repository
public class PostgreSQLTestDAO extends AbstractRepository<TableExampleTestDO> {

    @PostConstruct
    private void initDb() {
        db = db.clone();
        db.setDialect(new PostgresqlDialect(db.getNamedParameterJdbcTemplate(), db.getJdbcProperties()));
//        db.setDialect(new MysqlDialect(db.getNamedParameterJdbcTemplate(), db.getJdbcProperties()));
    }

}
```

## MySQL
完美的

## PostgreSQL
### 自增主键
> [👉PostgreSQL 数据类型参考](https://www.runoob.com/postgresql/postgresql-data-type.html)

#### 实现自增主键方式一
- 建表时选择`bigserial`类型

#### 实现自增主键方式二
- 建表时选择`int8`类型，勾选`✔标识`选项，值选择为`GENERATED BY DEFAULT`

![实现自增主键方式二](jdbc_files/SQL方言-1.jpg)

#### 实现自增主键方式三
创建自增序列语法示例：
```sql
CREATE SEQUENCE table_name_id_seq START 1; # 创建一个命名为table_name_id_seq的自增序列，从1开始自增
CREATE SEQUENCE table_test_id_seq START 10; # 创建一个命名为table_test_id_seq的自增序列，从10开始自增
CREATE SEQUENCE table_demo_id_seq START 1456465; # 创建一个命名为table_demo_id_seq的自增序列，从1456465开始自增
```
- `table_name_id_seq`为序列名称，你可以任意取，建议：`表名+id_seq`
- 一张表应该对应一个独有的自增序列，如果共用一个序列，会导致id跳段，因为所以表都使用这个序列递增

建表时id字段使用的默认值为：`nextval('table_name_id_seq'::regclass)`
- 不同表应该使用不同序列，避免自增值跳段

## FAQ
### PostgreSQL: column is of type timestamp without time zone but expression
数据源url添加`stringtype=unspecified`参数，示例：
```yml
spring:
  datasource:
    druid: 
      url: jdbc:postgresql://localhost:3306/database?stringtype=unspecified
```
